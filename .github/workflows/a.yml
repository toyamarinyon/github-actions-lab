name: create_discussion_for_meeting_note
on:
  push:
  workflow_dispatch:
  schedule:
    # cron: "åˆ† æ™‚ * * æ›œæ—¥"ã§æŒ‡å®šã—ã¾ã™ã€‚ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒç•°ãªã‚‹ã®ã§ã€9æ™‚é–“å‰ã®æ™‚é–“ã«ã—ã¦ãã ã•ã„ã€‚
    # ä¾‹: æ¯é€±æ—¥æ›œã€œæœ¨æ›œ 12:00ã«å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€€cron: "00 2 * * sun-thu"
    # ä¾‹: æœˆæ›œ 10:30ã«å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€€cron: "30 1 * * mon"
    - cron: "0 0 * * mon"

jobs:
  create_discussion_for_meeting_note:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    env:
      TZ: "Asia/Tokyo"
    steps:
      - id: get_date
        name: Get date
        run: |
          tomorrow=$(date --date '+1 day' +%Y/%m/%d)
          today=$(date +%Y/%m/%d)
          echo "tomorrow=$tomorrow" >> $GITHUB_OUTPUT
          echo "today=$today" >> $GITHUB_OUTPUT

      - name: Create a new discussion
        id: create_discussion
        uses: octokit/graphql-action@v2.x
        with:
          repositoryId: "R_kgDOKqVkug"
          categoryId: "DIC_kwDOKqVkus4CawA6"
          # Discussionã®Title
          # ${{steps.get_date.outputs.today}}ã¨å…¥åŠ›ã™ã‚‹ã¨ã€å½“æ—¥ã®æ—¥ä»˜ã«ç½®ãæ›ã‚ã‚Šã¾ã™
          # ä¾‹: ${{steps.get_date.outputs.today}} ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è­°äº‹ãƒ¡ãƒ¢
          # ${{steps.get_date.outputs.tomorrow}}ã¨å…¥åŠ›ã™ã‚‹ã¨ã€æ˜æ—¥ã®æ—¥ä»˜ã«ç½®ãæ›ã‚ã‚Šã¾ã™
          title: "yyyymmddï¼¿ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å®šä¾‹"
          # Discussionã®æœ¬æ–‡
        
          body: |-
            ğŸ“ ç¢ºèª Kanban

            - [Plain EDI Backlog](https://github.com
            - [å‰å›ã®è­°äº‹éŒ²](https://github.com/route06/plain)

            å…±æœ‰ãƒ»ç›¸è«‡äº‹é …ã‚ã‚Œã°è‡ªç”±ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„ ğŸ“

          # ã“ã“ã¯è§¦ã‚‰ãªãã¦OK
          query: |
            mutation($title:String!, $body:String!) {
              createDiscussion(input: {repositoryId: "R_kgDOKqVkug", categoryId: "DIC_kwDOKqVkus4CawA6", title: $title, body: $body}) {
                discussion {
                  id
                }
              }
            }
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
